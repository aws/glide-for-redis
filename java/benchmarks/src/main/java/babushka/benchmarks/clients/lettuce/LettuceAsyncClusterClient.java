/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package babushka.benchmarks.clients.lettuce;

import babushka.benchmarks.utils.ConnectionSettings;
import io.lettuce.core.RedisFuture;
import io.lettuce.core.RedisURI;
import io.lettuce.core.cluster.RedisClusterClient;
import io.lettuce.core.cluster.api.StatefulRedisClusterConnection;
import io.lettuce.core.cluster.api.async.RedisAdvancedClusterAsyncCommands;
import java.time.Duration;

public class LettuceAsyncClusterClient extends LettuceAsyncClient {

  private RedisClusterClient clusterClient;
  private RedisAdvancedClusterAsyncCommands clusterAsyncCommands;
  private StatefulRedisClusterConnection<String, String> clusterConnection;

  @Override
  public void connectToRedis(ConnectionSettings connectionSettings) {
    RedisURI uri =
        RedisURI.builder()
            .withHost(connectionSettings.host)
            .withPort(connectionSettings.port)
            .withSsl(connectionSettings.useSsl)
            .build();
    clusterClient = RedisClusterClient.create(uri);
    clusterConnection = clusterClient.connect();
    clusterConnection.setTimeout(Duration.ofSeconds(ASYNC_OPERATION_TIMEOUT_SEC));
    clusterAsyncCommands = clusterConnection.async();
  }

  @Override
  public RedisFuture<String> asyncSet(String key, String value) {
    return clusterAsyncCommands.set(key, value);
  }

  @Override
  public RedisFuture<String> asyncGet(String key) {
    return clusterAsyncCommands.get(key);
  }

  @Override
  public void closeConnection() {
    clusterConnection.close();
    clusterClient.shutdown();
  }

  @Override
  public String getName() {
    return "Lettuce Cluster Async";
  }
}
